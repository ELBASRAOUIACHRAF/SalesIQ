<div class="management-page">
  <!-- Header -->
  <header class="page-header">
    <div class="header-left">
      <h1 class="page-title"><mat-icon class="title-icon">monetization_on</mat-icon> Sales Management</h1>
      <p class="page-subtitle">Track and manage all sales transactions</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="exportSales()">
        <mat-icon class="btn-icon">file_download</mat-icon>
        Export CSV
      </button>
    </div>
  </header>

  <!-- Stats Cards -->
  <div class="stats-row">
    <div class="stat-card revenue">
      <div class="stat-icon"><mat-icon>payments</mat-icon></div>
      <div class="stat-content">
        <span class="stat-value">{{ formatCurrency(totalRevenue) }}</span>
        <span class="stat-label">Total Revenue</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><mat-icon>shopping_cart</mat-icon></div>
      <div class="stat-content">
        <span class="stat-value">{{ totalSales }}</span>
        <span class="stat-label">Total Sales</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><mat-icon>receipt_long</mat-icon></div>
      <div class="stat-content">
        <span class="stat-value">{{ formatCurrency(avgOrderValue) }}</span>
        <span class="stat-label">Avg. Order Value</span>
      </div>
    </div>
    <div class="stat-card status-breakdown">
      <div class="status-title">Status Breakdown</div>
      <div class="status-chips">
        <div *ngFor="let s of statusCounts" class="status-chip" [style.--chip-color]="s.color">
          <span class="chip-count">{{ s.count }}</span>
          <span class="chip-label">{{ s.status }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="search-box">
      <mat-icon class="search-icon">search</mat-icon>
      <input 
        type="text" 
        placeholder="Search by ID, User ID..."
        [(ngModel)]="searchTerm"
        (ngModelChange)="applyFilters()"
      />
    </div>
    <div class="filter-group">
      <select [(ngModel)]="selectedStatus" (ngModelChange)="applyFilters()">
        <option value="">All Statuses</option>
        <option *ngFor="let status of statuses" [value]="status">{{ status }}</option>
      </select>
    </div>
    <div class="filter-group">
      <select [(ngModel)]="selectedPayment" (ngModelChange)="applyFilters()">
        <option value="">All Payment Methods</option>
        <option *ngFor="let method of paymentMethods" [value]="method">{{ formatPaymentMethod(method) }}</option>
      </select>
    </div>
    <div class="results-count">
      {{ filteredSales.length }} sale(s) found
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading sales...</p>
  </div>

  <!-- Sales Table -->
  <div *ngIf="!loading" class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Date</th>
          <th>Amount</th>
          <th>Status</th>
          <th>Payment Method</th>
          <th>User ID</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let sale of paginatedSales">
          <td class="id-cell">#{{ sale.id }}</td>
          <td class="date-cell">{{ formatDate(sale.dateOfSale) }}</td>
          <td class="amount-cell">{{ formatCurrency(sale.totalAmount) }}</td>
          <td>
            <span class="status-badge" [ngClass]="getStatusClass(sale.status)">
              {{ sale.status }}
            </span>
          </td>
          <td class="payment-cell">{{ formatPaymentMethod(sale.paymentMethod) }}</td>
          <td class="user-cell">User #{{ sale.userId }}</td>
          <td class="actions-cell">
            <button class="action-btn view" (click)="openViewModal(sale)" title="View">
              <mat-icon>visibility</mat-icon>
            </button>
            <button class="action-btn edit" (click)="openEditModal(sale)" title="Edit">
              <mat-icon>edit</mat-icon>
            </button>
            <button class="action-btn delete" (click)="deleteSale(sale)" title="Delete">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </tr>
        <tr *ngIf="paginatedSales.length === 0">
          <td colspan="7" class="empty-cell">
            <div class="empty-state">
              <mat-icon class="empty-icon">point_of_sale</mat-icon>
              <p>No sales found</p>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div *ngIf="!loading && filteredSales.length > 0" class="pagination">
    <button 
      class="pagination-btn" 
      [disabled]="currentPage === 1"
      (click)="previousPage()"
    >
    <mat-icon>chevron_left</mat-icon> Previous
    </button>
    <span class="pagination-info">
      Page {{ currentPage }} of {{ totalPages }}
    </span>
    <button 
      class="pagination-btn" 
      [disabled]="currentPage === totalPages"
      (click)="nextPage()"
    >
      Next <mat-icon>chevron_right</mat-icon>
    </button>
  </div>

  <!-- Modal -->
  <div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>
          <mat-icon class="modal-icon">
            {{ modalMode === 'view' ? 'info' : 'edit' }}
          </mat-icon>
          {{ modalMode === 'view' ? 'Sale Details' : 'Edit Sale' }}
        </h2>
        <button class="close-btn" (click)="closeModal()">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      
      <div class="modal-body">
        <!-- View Mode -->
        <div *ngIf="modalMode === 'view' && selectedSale" class="view-details">
          <div class="sale-summary">
            <div class="summary-amount">{{ formatCurrency(selectedSale.totalAmount) }}</div>
            <span class="status-badge large" [ngClass]="getStatusClass(selectedSale.status)">
              {{ selectedSale.status }}
            </span>
          </div>
          <div class="detail-grid">
            <div class="detail-row">
              <span class="detail-label">Sale ID:</span>
              <span class="detail-value">#{{ selectedSale.id }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">User ID:</span>
              <span class="detail-value">User #{{ selectedSale.userId }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Date:</span>
              <span class="detail-value">{{ formatDate(selectedSale.dateOfSale) }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Payment:</span>
              <span class="detail-value">{{ formatPaymentMethod(selectedSale.paymentMethod) }}</span>
            </div>
          </div>
        </div>

        <!-- Edit Form -->
        <form *ngIf="modalMode === 'edit'" class="sale-form">
          <div class="form-row">
            <div class="form-group">
              <label>Total Amount ($)</label>
              <input type="number" [(ngModel)]="formData.totalAmount" name="totalAmount" min="0" step="0.01" />
            </div>
            <div class="form-group">
              <label>Status</label>
              <select [(ngModel)]="formData.status" name="status">
                <option *ngFor="let status of statuses" [value]="status">{{ status }}</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Payment Method</label>
              <select [(ngModel)]="formData.paymentMethod" name="paymentMethod">
                <option *ngFor="let method of paymentMethods" [value]="method">{{ formatPaymentMethod(method) }}</option>
              </select>
            </div>
            <div class="form-group">
              <label>User ID</label>
              <input type="number" [(ngModel)]="formData.userId" name="userId" />
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer" *ngIf="modalMode === 'edit'">
        <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
        <button class="btn btn-primary" (click)="saveSale()">Save Changes</button>
      </div>
      <div class="modal-footer" *ngIf="modalMode === 'view'">
        <button class="btn btn-secondary" (click)="closeModal()">Close</button>
        <button class="btn btn-primary" (click)="openEditModal(selectedSale!)">Edit Sale</button>
      </div>
    </div>
  </div>
</div>
