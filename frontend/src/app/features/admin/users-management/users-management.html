<div class="management-page">
  <!-- Header -->
  <header class="page-header">
    <div class="header-left">
      <h1 class="page-title">üë• User Management</h1>
      <p class="page-subtitle">Manage registered users</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="openAddModal()">
        <span class="btn-icon">‚ûï</span>
        Add User
      </button>
      <button class="btn btn-secondary" (click)="exportUsers()">
        <span class="btn-icon">üì§</span>
        Export CSV
      </button>
    </div>
  </header>

  <!-- Filters -->
  <div class="filters-section">
    <div class="search-box">
      <span class="search-icon">üîç</span>
      <input 
        type="text" 
        placeholder="Search users..."
        [(ngModel)]="searchTerm"
        (ngModelChange)="applyFilters()"
      />
    </div>
    <div class="filter-group">
      <select [(ngModel)]="selectedRole" (ngModelChange)="applyFilters()">
        <option value="">All Roles</option>
        <option *ngFor="let role of roles" [value]="role">{{ role }}</option>
      </select>
    </div>
    <div class="results-count">
      {{ filteredUsers.length }} user(s) found
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading users...</p>
  </div>

  <!-- Users Table -->
  <div *ngIf="!loading" class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Username</th>
          <th>Name</th>
          <th>Email</th>
          <th>Role</th>
          <th>Created</th>
          <th>Last Login</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of paginatedUsers">
          <td class="id-cell">#{{ user.id }}</td>
          <td class="username-cell">
            <div class="user-info">
              <span class="user-avatar">{{ user.username ? user.username.charAt(0).toUpperCase() : '?' }}</span>
              {{ user.username }}
            </div>
          </td>
          <td>{{ user.firstName }} {{ user.lastName }}</td>
          <td class="email-cell">{{ user.email }}</td>
          <td>
            <span class="role-badge" [ngClass]="getRoleClass(user.role)">
              {{ user.role }}
            </span>
          </td>
          <td class="date-cell">{{ formatDate(user.createdAt) }}</td>
          <td class="date-cell">{{ formatDate(user.lastLogin) }}</td>
          <td class="actions-cell">
            <button class="action-btn view" (click)="openViewModal(user)" title="View">
              üëÅÔ∏è
            </button>
            <button class="action-btn edit" (click)="openEditModal(user)" title="Edit">
              ‚úèÔ∏è
            </button>
            <button class="action-btn delete" (click)="deleteUser(user)" title="Delete">
              üóëÔ∏è
            </button>
          </td>
        </tr>
        <tr *ngIf="paginatedUsers.length === 0">
          <td colspan="8" class="empty-cell">
            <div class="empty-state">
              <span class="empty-icon">üë•</span>
              <p>No users found</p>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div *ngIf="!loading && filteredUsers.length > 0" class="pagination">
    <button 
      class="pagination-btn" 
      [disabled]="currentPage === 1"
      (click)="previousPage()"
    >
      ‚Üê Previous
    </button>
    <span class="pagination-info">
      Page {{ currentPage }} of {{ totalPages }}
    </span>
    <button 
      class="pagination-btn" 
      [disabled]="currentPage === totalPages"
      (click)="nextPage()"
    >
      Next ‚Üí
    </button>
  </div>

  <!-- Modal -->
  <div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>
          {{ modalMode === 'add' ? '‚ûï Add New User' : 
             modalMode === 'edit' ? '‚úèÔ∏è Edit User' : 'üëÅÔ∏è User Details' }}
        </h2>
        <button class="close-btn" (click)="closeModal()">‚úï</button>
      </div>
      
      <div class="modal-body">
        <!-- View Mode -->
        <div *ngIf="modalMode === 'view' && selectedUser" class="view-details">
          <div class="detail-row">
            <span class="detail-label">Username:</span>
            <span class="detail-value">{{ selectedUser.username }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Full Name:</span>
            <span class="detail-value">{{ selectedUser.firstName }} {{ selectedUser.lastName }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Email:</span>
            <span class="detail-value">{{ selectedUser.email }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Phone:</span>
            <span class="detail-value">{{ selectedUser.phoneNumber || 'N/A' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Role:</span>
            <span class="detail-value">
              <span class="role-badge" [ngClass]="getRoleClass(selectedUser.role)">
                {{ selectedUser.role }}
              </span>
            </span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Location:</span>
            <span class="detail-value">{{ selectedUser.city || 'N/A' }}, {{ selectedUser.country || 'N/A' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Hours Logged In:</span>
            <span class="detail-value">{{ selectedUser.hoursLoggedIn || 0 }} hours</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Created At:</span>
            <span class="detail-value">{{ formatDate(selectedUser.createdAt) }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Last Login:</span>
            <span class="detail-value">{{ formatDate(selectedUser.lastLogin) }}</span>
          </div>
        </div>

        <!-- Add/Edit Form -->
        <form *ngIf="modalMode === 'add' || modalMode === 'edit'" class="user-form">
          <div class="form-row">
            <div class="form-group">
              <label>Username</label>
              <input type="text" [(ngModel)]="formData.username" name="username" required placeholder="Enter username" />
            </div>
            <div class="form-group">
              <label>Email</label>
              <input type="email" [(ngModel)]="formData.email" name="email" required placeholder="Enter email" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>First Name</label>
              <input type="text" [(ngModel)]="formData.firstName" name="firstName" placeholder="Enter first name" />
            </div>
            <div class="form-group">
              <label>Last Name</label>
              <input type="text" [(ngModel)]="formData.lastName" name="lastName" placeholder="Enter last name" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Phone Number</label>
              <input type="tel" [(ngModel)]="formData.phoneNumber" name="phoneNumber" placeholder="Enter phone number" />
            </div>
            <div class="form-group">
              <label>Role</label>
              <select [(ngModel)]="formData.role" name="role">
                <option *ngFor="let role of roles" [value]="role">{{ role }}</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>City</label>
              <input type="text" [(ngModel)]="formData.city" name="city" placeholder="Enter city" />
            </div>
            <div class="form-group">
              <label>Country</label>
              <input type="text" [(ngModel)]="formData.country" name="country" placeholder="Enter country" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Postal Code</label>
              <input type="text" [(ngModel)]="formData.postalCode" name="postalCode" placeholder="Enter postal code" />
            </div>
            <div class="form-group">
              <label>Status</label>
              <select [(ngModel)]="formData.active" name="active">
                <option [ngValue]="true">Active</option>
                <option [ngValue]="false">Inactive</option>
              </select>
            </div>
          </div>
          <div class="form-group full-width">
            <label>Bio</label>
            <textarea [(ngModel)]="formData.bio" name="bio" rows="3" placeholder="Enter bio..."></textarea>
          </div>
        </form>
      </div>

      <div class="modal-footer" *ngIf="modalMode === 'add'">
        <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
        <button class="btn btn-primary" (click)="saveUser()">Create User</button>
      </div>
      <div class="modal-footer" *ngIf="modalMode === 'edit'">
        <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
        <button class="btn btn-primary" (click)="saveUser()">Save Changes</button>
      </div>
      <div class="modal-footer" *ngIf="modalMode === 'view'">
        <button class="btn btn-secondary" (click)="closeModal()">Close</button>
        <button class="btn btn-primary" (click)="openEditModal(selectedUser!)">Edit User</button>
      </div>
    </div>
  </div>
</div>
