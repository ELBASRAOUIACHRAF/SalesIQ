<div class="management-page">
  <!-- Header -->
  <header class="page-header">
    <div class="header-left">
      <h1 class="page-title">â­ Reviews Management</h1>
      <p class="page-subtitle">Monitor and manage customer reviews</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="exportReviews()">
        <span class="btn-icon">ğŸ“¤</span>
        Export CSV
      </button>
    </div>
  </header>

  <!-- Stats Cards -->
  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-icon">ğŸ“Š</div>
      <div class="stat-content">
        <span class="stat-value">{{ totalReviews }}</span>
        <span class="stat-label">Total Reviews</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">â­</div>
      <div class="stat-content">
        <span class="stat-value">{{ averageRating | number:'1.1-1' }}</span>
        <span class="stat-label">Average Rating</span>
      </div>
    </div>
    <div class="stat-card distribution-card">
      <div class="distribution-title">Rating Distribution</div>
      <div class="distribution-bars">
        <div *ngFor="let dist of ratingDistribution" class="distribution-row">
          <span class="dist-label">{{ dist.rating }}â˜…</span>
          <div class="dist-bar-bg">
            <div class="dist-bar" [style.width.%]="dist.percentage"></div>
          </div>
          <span class="dist-count">{{ dist.count }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="search-box">
      <span class="search-icon">ğŸ”</span>
      <input 
        type="text" 
        placeholder="Search reviews..."
        [(ngModel)]="searchTerm"
        (ngModelChange)="applyFilters()"
      />
    </div>
    <div class="filter-group">
      <select [(ngModel)]="selectedRating" (ngModelChange)="applyFilters()">
        <option value="">All Ratings</option>
        <option value="5">5 Stars</option>
        <option value="4">4 Stars</option>
        <option value="3">3 Stars</option>
        <option value="2">2 Stars</option>
        <option value="1">1 Star</option>
      </select>
    </div>
    <div class="results-count">
      {{ filteredReviews.length }} review(s) found
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading reviews...</p>
  </div>

  <!-- Reviews List -->
  <div *ngIf="!loading" class="reviews-list">
    <div *ngFor="let review of paginatedReviews" class="review-card">
      <div class="review-header">
        <div class="review-user">
          <span class="user-avatar">{{ (review.userEmail || 'U').charAt(0).toUpperCase() }}</span>
          <div class="user-info">
            <span class="user-name">{{ review.userEmail || 'Anonymous' }}</span>
            <span class="review-date">{{ formatDate(review.reviewDate) }}</span>
          </div>
        </div>
        <div class="review-rating" [ngClass]="getRatingClass(review.rating)">
          <span class="stars">{{ getStars(review.rating) }}</span>
          <span class="rating-value">{{ review.rating | number:'1.1-1' }}</span>
        </div>
      </div>
      <div class="review-body">
        <p class="review-product">Product: <strong>{{ review.productName || 'Unknown Product' }}</strong></p>
        <p class="review-comment">{{ review.comment || 'No comment provided' }}</p>
      </div>
      <div class="review-actions">
        <button class="action-btn view" (click)="openViewModal(review)" title="View">
          ğŸ‘ï¸
        </button>
        <button class="action-btn edit" (click)="openEditModal(review)" title="Edit">
          âœï¸
        </button>
        <button class="action-btn delete" (click)="deleteReview(review)" title="Delete">
          ğŸ—‘ï¸
        </button>
      </div>
    </div>

    <div *ngIf="paginatedReviews.length === 0" class="empty-state">
      <span class="empty-icon">â­</span>
      <p>No reviews found</p>
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="!loading && filteredReviews.length > 0" class="pagination">
    <button 
      class="pagination-btn" 
      [disabled]="currentPage === 1"
      (click)="previousPage()"
    >
      â† Previous
    </button>
    <span class="pagination-info">
      Page {{ currentPage }} of {{ totalPages }}
    </span>
    <button 
      class="pagination-btn" 
      [disabled]="currentPage === totalPages"
      (click)="nextPage()"
    >
      Next â†’
    </button>
  </div>

  <!-- Modal -->
  <div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ modalMode === 'view' ? 'ğŸ‘ï¸ Review Details' : 'âœï¸ Edit Review' }}</h2>
        <button class="close-btn" (click)="closeModal()">âœ•</button>
      </div>
      
      <div class="modal-body">
        <!-- View Mode -->
        <div *ngIf="modalMode === 'view' && selectedReview" class="view-details">
          <div class="review-preview">
            <div class="preview-rating" [ngClass]="getRatingClass(selectedReview.rating)">
              <span class="stars-large">{{ getStars(selectedReview.rating) }}</span>
              <span class="rating-large">{{ selectedReview.rating | number:'1.1-1' }} / 5</span>
            </div>
          </div>
          <div class="detail-row">
            <span class="detail-label">Review ID:</span>
            <span class="detail-value">#{{ selectedReview.id }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">User:</span>
            <span class="detail-value">{{ selectedReview.userEmail || 'Anonymous' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Product:</span>
            <span class="detail-value">{{ selectedReview.productName || 'Unknown Product' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Date:</span>
            <span class="detail-value">{{ formatDate(selectedReview.reviewDate) }}</span>
          </div>
          <div class="detail-row full-width">
            <span class="detail-label">Comment:</span>
            <span class="detail-value comment">{{ selectedReview.comment || 'No comment provided' }}</span>
          </div>
        </div>

        <!-- Edit Form -->
        <form *ngIf="modalMode === 'edit'" class="review-form">
          <div class="form-group">
            <label>Rating</label>
            <input type="number" [(ngModel)]="formData.rating" name="rating" min="1" max="5" step="0.1" />
          </div>
          <div class="form-group">
            <label>Comment</label>
            <textarea [(ngModel)]="formData.comment" name="comment" rows="5"></textarea>
          </div>
        </form>
      </div>

      <div class="modal-footer" *ngIf="modalMode === 'edit'">
        <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
        <button class="btn btn-primary" (click)="saveReview()">Save Changes</button>
      </div>
      <div class="modal-footer" *ngIf="modalMode === 'view'">
        <button class="btn btn-secondary" (click)="closeModal()">Close</button>
        <button class="btn btn-primary" (click)="openEditModal(selectedReview!)">Edit Review</button>
      </div>
    </div>
  </div>
</div>
