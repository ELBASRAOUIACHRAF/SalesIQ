<div class="management-page">
  <!-- Header -->
  <header class="page-header">
    <div class="header-left">
      <h1 class="page-title">üì¶ Product Management</h1>
      <p class="page-subtitle">Manage your product catalog</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="exportProducts()">
        <span class="btn-icon">üì§</span>
        Export CSV
      </button>
      <button class="btn btn-primary" (click)="openAddModal()">
        <span class="btn-icon">‚ûï</span>
        Add Product
      </button>
    </div>
  </header>

  <!-- Filters -->
  <div class="filters-section">
    <div class="search-box">
      <span class="search-icon">üîç</span>
      <input 
        type="text" 
        placeholder="Search products..."
        [(ngModel)]="searchTerm"
        (ngModelChange)="applyFilters()"
      />
    </div>
    <div class="filter-group">
      <select [(ngModel)]="selectedCategory" (ngModelChange)="applyFilters()">
        <option value="">All Categories</option>
        <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
      </select>
    </div>
    <div class="filter-group">
      <select [(ngModel)]="priceRange" (ngModelChange)="applyFilters()">
        <option value="">All Prices</option>
        <option value="0-50">$0 - $50</option>
        <option value="50-100">$50 - $100</option>
        <option value="100-500">$100 - $500</option>
        <option value="500-">$500+</option>
      </select>
    </div>
    <div class="results-count">
      {{ filteredProducts.length }} product(s) found
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading products...</p>
  </div>

  <!-- Products Grid -->
  <div *ngIf="!loading" class="products-grid">
    <div *ngFor="let product of paginatedProducts" class="product-card">
      <div class="product-image">
        <img 
          [src]="product.imageUrl || 'assets/placeholder.png'" 
          [alt]="product.name"
          (error)="$any($event.target).src = 'https://via.placeholder.com/200x200?text=No+Image'"
        />
        <span class="stock-badge" [ngClass]="getStockStatus(product.stock)">
          {{ getStockLabel(product.stock) }}
        </span>
      </div>
      <div class="product-info">
        <h3 class="product-name">{{ product.name }}</h3>
        <p class="product-brand">{{ product.brand }}</p>
        <div class="product-meta">
          <span class="product-price">{{ formatPrice(product.price) }}</span>
          <span class="product-rating">‚≠ê {{ product.rating | number:'1.1-1' }}</span>
        </div>
        <p class="product-category">{{ getCategoryName(product.categoryId || 0) }}</p>
        <p class="product-quantity">Stock: {{ product.stock }} units</p>
      </div>
      <div class="product-actions">
        <button class="action-btn view" (click)="openViewModal(product)" title="View">
          üëÅÔ∏è
        </button>
        <button class="action-btn edit" (click)="openEditModal(product)" title="Edit">
          ‚úèÔ∏è
        </button>
        <button class="action-btn delete" (click)="deleteProduct(product)" title="Delete">
          üóëÔ∏è
        </button>
      </div>
    </div>

    <div *ngIf="paginatedProducts.length === 0" class="empty-state">
      <span class="empty-icon">üì¶</span>
      <p>No products found</p>
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="!loading && filteredProducts.length > 0" class="pagination">
    <button 
      class="pagination-btn" 
      [disabled]="currentPage === 1"
      (click)="previousPage()"
    >
      ‚Üê Previous
    </button>
    <span class="pagination-info">
      Page {{ currentPage }} of {{ totalPages }}
    </span>
    <button 
      class="pagination-btn" 
      [disabled]="currentPage === totalPages"
      (click)="nextPage()"
    >
      Next ‚Üí
    </button>
  </div>

  <!-- Modal -->
  <div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content modal-large" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>
          {{ modalMode === 'add' ? '‚ûï Add New Product' : 
             modalMode === 'edit' ? '‚úèÔ∏è Edit Product' : 'üëÅÔ∏è Product Details' }}
        </h2>
        <button class="close-btn" (click)="closeModal()">‚úï</button>
      </div>
      
      <div class="modal-body">
        <!-- View Mode -->
        <div *ngIf="modalMode === 'view' && selectedProduct" class="view-details">
          <div class="product-detail-image">
            <img 
              [src]="selectedProduct.imageUrl || 'https://via.placeholder.com/300x300?text=No+Image'" 
              [alt]="selectedProduct.name"
            />
          </div>
          <div class="detail-grid">
            <div class="detail-row">
              <span class="detail-label">Name:</span>
              <span class="detail-value">{{ selectedProduct.name }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Brand:</span>
              <span class="detail-value">{{ selectedProduct.brand }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Price:</span>
              <span class="detail-value price">{{ formatPrice(selectedProduct.price) }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Stock:</span>
              <span class="detail-value">
                <span class="stock-badge inline" [ngClass]="getStockStatus(selectedProduct.stock)">
                  {{ selectedProduct.stock }} units
                </span>
              </span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Rating:</span>
              <span class="detail-value">‚≠ê {{ selectedProduct.rating | number:'1.1-1' }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Category:</span>
              <span class="detail-value">{{ getCategoryName(selectedProduct.categoryId || 0) }}</span>
            </div>
            <div class="detail-row full-width">
              <span class="detail-label">Description:</span>
              <span class="detail-value">{{ selectedProduct.optionsText || 'No description' }}</span>
            </div>
          </div>
        </div>

        <!-- Add/Edit Form -->
        <form *ngIf="modalMode !== 'view'" class="product-form">
          <div class="form-row">
            <div class="form-group">
              <label>Product Name</label>
              <input type="text" [(ngModel)]="formData.name" name="name" required />
            </div>
            <div class="form-group">
              <label>Brand</label>
              <input type="text" [(ngModel)]="formData.brand" name="brand" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Price ($)</label>
              <input type="number" [(ngModel)]="formData.price" name="price" min="0" step="0.01" required />
            </div>
            <div class="form-group">
              <label>Stock Quantity</label>
              <input type="number" [(ngModel)]="formData.stock" name="stock" min="0" required />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Category</label>
              <select [(ngModel)]="formData.categoryId" name="categoryId">
                <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
              </select>
            </div>
            <div class="form-group">
              <label>Rating</label>
              <input type="number" [(ngModel)]="formData.rating" name="rating" min="0" max="5" step="0.1" />
            </div>
          </div>
          <div class="form-group">
            <label>Image URL</label>
            <input type="url" [(ngModel)]="formData.imageUrl" name="imageUrl" placeholder="https://..." />
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea [(ngModel)]="formData.optionsText" name="optionsText" rows="4"></textarea>
          </div>
        </form>
      </div>

      <div class="modal-footer" *ngIf="modalMode !== 'view'">
        <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
        <button class="btn btn-primary" (click)="saveProduct()">
          {{ modalMode === 'add' ? 'Create Product' : 'Save Changes' }}
        </button>
      </div>
      <div class="modal-footer" *ngIf="modalMode === 'view'">
        <button class="btn btn-secondary" (click)="closeModal()">Close</button>
        <button class="btn btn-primary" (click)="openEditModal(selectedProduct!)">Edit Product</button>
      </div>
    </div>
  </div>
</div>
