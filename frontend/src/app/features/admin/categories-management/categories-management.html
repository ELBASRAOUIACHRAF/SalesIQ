<div class="management-page">
  <!-- Header -->
  <header class="page-header">
    <div class="header-left">
      <h1 class="page-title"><mat-icon class="title-icon">category</mat-icon> Category Management</h1>
      <p class="page-subtitle">Organize your product categories</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="exportCategories()">
        <span class="btn-icon"><mat-icon class="btn-icon">file_download</mat-icon></span>
        Export CSV
      </button>
      <button class="btn btn-primary" (click)="openAddModal()">
        <span class="btn-icon"><mat-icon class="btn-icon">add</mat-icon></span>
        Add Category
      </button>
    </div>
  </header>

  <!-- Filters -->
  <div class="filters-section">
    <div class="search-box">
      <span class="search-icon"><mat-icon class="search-icon">search</mat-icon></span>
      <input 
        type="text" 
        placeholder="Search categories..."
        [(ngModel)]="searchTerm"
        (ngModelChange)="applyFilters()"
      />
    </div>
    <div class="results-count">
      {{ filteredCategories.length }} category(ies) found
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading categories...</p>
  </div>

  <!-- Categories Grid -->
  <div *ngIf="!loading" class="categories-grid">
    <div *ngFor="let category of filteredCategories" class="category-card">
      <div class="category-icon">
        <mat-icon>{{ getCategoryIcon(category.name) }}</mat-icon>
      </div>
      <div class="category-info">
        <h3 class="category-name">{{ category.name }}</h3>
        <p class="category-description">{{ category.description || 'No description' }}</p>
        <div class="category-meta">
          <span class="category-id">ID: #{{ category.id }}</span>
        </div>
      </div>
      <div class="category-actions">
        <button class="action-btn view" (click)="openViewModal(category)" title="View">
          <mat-icon>visibility</mat-icon>
        </button>
        <button class="action-btn edit" (click)="openEditModal(category)" title="Edit">
          <mat-icon>edit</mat-icon>
        </button>
        <button class="action-btn delete" (click)="deleteCategory(category)" title="Delete">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
    </div>

    <div *ngIf="filteredCategories.length === 0" class="empty-state">
      <span class="empty-icon"><mat-icon class="empty-icon">label_off</mat-icon></span>
      <p>No categories found</p>
    </div>
  </div>

  <!-- Modal -->
  <div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>
          <mat-icon class="modal-icon">
            {{ modalMode === 'add' ? 'add_circle' : modalMode === 'edit' ? 'edit' : 'info' }}
          </mat-icon>
          {{ modalMode === 'add' ? 'Add New Category' : modalMode === 'edit' ? 'Edit Category' : 'Category Details' }}
        </h2>
        <button class="close-btn" (click)="closeModal()"><mat-icon>close</mat-icon></button>
      </div>
      
      <div class="modal-body">
        <!-- View Mode -->
        <div *ngIf="modalMode === 'view' && selectedCategory" class="view-details">
          <div class="category-preview">
            <span class="preview-icon"><mat-icon>{{ getCategoryIcon(selectedCategory.name) }}</mat-icon></span>
            <h3>{{ selectedCategory.name }}</h3>
          </div>
          <div class="detail-row">
            <span class="detail-label">ID:</span>
            <span class="detail-value">#{{ selectedCategory.id }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Name:</span>
            <span class="detail-value">{{ selectedCategory.name }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Description:</span>
            <span class="detail-value">{{ selectedCategory.description || 'No description' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Status:</span>
            <span class="detail-value">
              {{ selectedCategory.isActive ? 'Active' : 'Inactive' }}
            </span>
          </div>
        </div>

        <!-- Add/Edit Form -->
        <form *ngIf="modalMode !== 'view'" class="category-form">
          <div class="form-group">
            <label>Category Name</label>
            <input type="text" [(ngModel)]="formData.name" name="name" required placeholder="Enter category name" />
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea 
              [(ngModel)]="formData.description" 
              name="description" 
              rows="4"
              placeholder="Enter category description..."
            ></textarea>
          </div>
          <div class="form-group">
            <label>Status</label>
            <label class="status-toggle">
              <input type="checkbox" [(ngModel)]="formData.isActive" name="isActive" />
              <span>{{ formData.isActive ? 'Active' : 'Inactive' }}</span>
            </label>
          </div>
          <div class="form-preview">
            <span class="preview-label">Preview:</span>
            <div class="preview-card">
              <span class="preview-icon"><mat-icon>{{ getCategoryIcon(formData.name || '') }}</mat-icon></span>
              <span class="preview-name">{{ formData.name || 'Category Name' }}</span>
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer" *ngIf="modalMode !== 'view'">
        <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
        <button class="btn btn-primary" (click)="saveCategory()">
          {{ modalMode === 'add' ? 'Create Category' : 'Save Changes' }}
        </button>
      </div>
      <div class="modal-footer" *ngIf="modalMode === 'view'">
        <button class="btn btn-secondary" (click)="closeModal()">Close</button>
        <button class="btn btn-primary" (click)="openEditModal(selectedCategory!)">Edit Category</button>
      </div>
    </div>
  </div>
</div>
