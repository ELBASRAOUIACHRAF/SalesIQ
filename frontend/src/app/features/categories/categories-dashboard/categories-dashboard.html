<div class="dashboard-layout">
  <div class="dashboard-content">
    <!-- Header -->
    <div class="dashboard-header">
      <app-top-bar
        [title]="'Categories Analytics'"
        [tabs]="['Overview']"
        [activeTab]="'Overview'"
        [dateText]="'Category Performance'"
      ></app-top-bar>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>Loading categories...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-state">
      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <line x1="12" y1="8" x2="12" y2="12"/>
        <line x1="12" y1="16" x2="12.01" y2="16"/>
      </svg>
      <p class="error-message">{{ error }}</p>
      <button class="retry-btn" (click)="loadData()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M23 4v6h-6M1 20v-6h6"/>
          <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
        </svg>
        Retry
      </button>
    </div>

    <!-- Dashboard Content -->
    <ng-container *ngIf="!loading && !error">
      <!-- KPI Cards -->
      <div class="kpi-cards">
        <app-kpi-card
          *ngFor="let k of kpis"
          [title]="k.title"
          [value]="k.value"
          [subtitle]="k.subtitle"
          [change]="k.change"
          [sparkline]="k.sparkline"
          [accentColor]="k.accentColor"
        ></app-kpi-card>
      </div>

      <!-- Category Performance Chart -->
      <section class="analytics-section">
        <app-category-performance></app-category-performance>
      </section>

      <!-- Categories Section -->
      <section class="categories-section">
        <!-- Section Header with Controls -->
        <div class="section-header">
          <h2 class="section-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 3h7v7H3zM14 3h7v7h-7zM14 14h7v7h-7zM3 14h7v7H3z"/>
            </svg>
            Categories ({{ filteredCategories.length }})
          </h2>
          
          <div class="controls">
            <!-- Search -->
            <div class="search-box">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <path d="m21 21-4.35-4.35"/>
              </svg>
              <input 
                type="text" 
                placeholder="Search categories..." 
                [(ngModel)]="searchTerm"
              />
            </div>

            <!-- Filter Status -->
            <div class="filter-group">
              <button 
                class="filter-btn" 
                [class.active]="filterStatus === 'all'"
                (click)="filterStatus = 'all'"
              >All</button>
              <button 
                class="filter-btn" 
                [class.active]="filterStatus === 'active'"
                (click)="filterStatus = 'active'"
              >Active</button>
              <button 
                class="filter-btn" 
                [class.active]="filterStatus === 'inactive'"
                (click)="filterStatus = 'inactive'"
              >Inactive</button>
            </div>
          </div>
        </div>

        <!-- Categories Table -->
        <div class="categories-table-container">
          <table class="categories-table">
            <thead>
              <tr>
                <th (click)="setSortBy('name')" class="sortable">
                  Category Name
                  <span class="sort-icon" *ngIf="sortBy === 'name'">{{ sortDirection === 'asc' ? '↑' : '↓' }}</span>
                </th>
                <th (click)="setSortBy('products')" class="sortable">
                  Products
                  <span class="sort-icon" *ngIf="sortBy === 'products'">{{ sortDirection === 'asc' ? '↑' : '↓' }}</span>
                </th>
                <th (click)="setSortBy('revenue')" class="sortable">
                  Revenue
                  <span class="sort-icon" *ngIf="sortBy === 'revenue'">{{ sortDirection === 'asc' ? '↑' : '↓' }}</span>
                </th>
                <th>Performance</th>
                <th (click)="setSortBy('status')" class="sortable">
                  Status
                  <span class="sort-icon" *ngIf="sortBy === 'status'">{{ sortDirection === 'asc' ? '↑' : '↓' }}</span>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let category of filteredCategories" class="category-row">
                <td class="category-name-cell">
                  <div class="category-info">
                    <div class="category-icon" [style.background]="category.isActive ? '#6366f1' : '#9ca3af'">
                      {{ category.name.charAt(0).toUpperCase() }}
                    </div>
                    <div class="category-details">
                      <span class="category-name">{{ category.name }}</span>
                      <span class="category-desc">{{ category.description || 'No description' }}</span>
                    </div>
                  </div>
                </td>
                <td class="products-cell">
                  <span class="product-count">{{ category.productCount || 0 }}</span>
                  <span class="product-label">products</span>
                </td>
                <td class="revenue-cell">
                  <span class="revenue-amount">{{ formatCurrency(category.revenue || 0) }}</span>
                  <span class="sales-count">{{ category.salesCount || 0 }} sales</span>
                </td>
                <td class="performance-cell">
                  <div class="performance-bar-container">
                    <div class="performance-bar" [style.width.%]="getRevenuePercentage(category.revenue || 0)"></div>
                  </div>
                  <span class="performance-label">{{ getRevenuePercentage(category.revenue || 0) | number:'1.0-0' }}%</span>
                </td>
                <td class="status-cell">
                  <span 
                    class="status-badge" 
                    [class.active]="category.isActive"
                    [class.inactive]="!category.isActive"
                  >
                    {{ category.isActive ? 'Active' : 'Inactive' }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>

          <!-- Empty State -->
          <div *ngIf="filteredCategories.length === 0" class="empty-state">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M3 3h7v7H3zM14 3h7v7h-7zM14 14h7v7h-7zM3 14h7v7H3z"/>
            </svg>
            <h3>No categories found</h3>
            <p *ngIf="searchTerm">No categories match "{{ searchTerm }}"</p>
            <p *ngIf="!searchTerm">No categories available</p>
          </div>
        </div>
      </section>
    </ng-container>
  </div>
</div>