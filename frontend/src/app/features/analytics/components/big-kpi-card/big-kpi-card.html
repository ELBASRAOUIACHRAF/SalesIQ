<div class="big-card" role="group" [attr.aria-label]="title" [style.--accent-color]="color">
  <div class="card-glow" [style.background]="color"></div>
  
  <div class="header">
    <div class="header-left">
      <div class="icon" *ngIf="iconUrl || iconClass">
        <img *ngIf="iconUrl" [src]="iconUrl" [alt]="title + ' icon'" />
        <i *ngIf="!iconUrl && iconClass" [class]="iconClass" aria-hidden="true"></i>
      </div>
      <div class="titles">
        <div class="title">{{ title }}</div>
        <div class="subtitle" *ngIf="subtitle">{{ subtitle }}</div>
      </div>
    </div>
    <div class="header-right">
      <div class="value">{{ formatValue() }}</div>
      <div
        class="change"
        [class.up]="change && change > 0"
        [class.down]="change && change < 0"
        [class.neutral]="change === 0"
        *ngIf="change !== undefined"
      >
        <span class="arrow">{{ change && change > 0 ? 'â–²' : change && change < 0 ? 'â–¼' : 'â€¢' }}</span>
        <span>{{ change && change > 0 ? '+' : ''}}{{ change | number:'1.0-2' }}%</span>
      </div>
    </div>
  </div>

  <div class="chart-container" *ngIf="chartData?.length">
    <div class="chart-stats" *ngIf="stats">
      <div class="stat-row">
        <div class="stat-item">
          <span class="stat-label">Minimum</span>
          <span class="stat-value">{{ formatNumber(stats.min) }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Average</span>
          <span class="stat-value">{{ formatNumber(stats.avg) }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Maximum</span>
          <span class="stat-value">{{ formatNumber(stats.max) }}</span>
        </div>
        <div class="stat-item trend" [class.trend-up]="stats.trend === 'up'" [class.trend-down]="stats.trend === 'down'">
          <span class="stat-label">Period Change</span>
          <span class="stat-value">{{ stats.trend === 'up' ? 'â†‘' : stats.trend === 'down' ? 'â†“' : 'â†’' }} {{ stats.trendPercent.toFixed(1) }}%</span>
        </div>
      </div>
    </div>
    
    <svg [attr.viewBox]="'0 0 ' + chartW + ' ' + chartH" preserveAspectRatio="none" [class.animated]="chartAnimated" class="chart-svg">
      <defs>
        <linearGradient [attr.id]="gradientId()" x1="0" x2="0" y1="0" y2="1">
          <stop offset="0%" [attr.stop-color]="color" stop-opacity="0.3" />
          <stop offset="50%" [attr.stop-color]="color" stop-opacity="0.15" />
          <stop offset="100%" [attr.stop-color]="color" stop-opacity="0.05" />
        </linearGradient>
        <filter [attr.id]="'glow-' + gradientId()">
          <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
          <feMerge>
            <feMergeNode in="coloredBlur"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
      </defs>

      <!-- Grid lines (Y-axis) -->
      <g class="grid-lines" *ngIf="showAxes">
        <line
          *ngFor="let tick of getYAxisTicks()"
          [attr.x1]="padding.left"
          [attr.x2]="chartW - padding.right"
          [attr.y1]="getYAxisPosition(tick)"
          [attr.y2]="getYAxisPosition(tick)"
          stroke="#e5e7eb"
          stroke-width="1"
          stroke-dasharray="2,2"
        />
      </g>

      <!-- Y-axis labels -->
      <g class="y-axis-labels" *ngIf="showAxes">
        <text
          *ngFor="let tick of getYAxisTicks()"
          [attr.x]="padding.left - 10"
          [attr.y]="getYAxisPosition(tick) + 4"
          fill="#6b7280"
          font-size="11"
          font-weight="500"
          text-anchor="end"
          class="axis-label"
        >{{ formatNumber(tick) }}</text>
      </g>

      <!-- X-axis line -->
      <line
        *ngIf="showAxes"
        [attr.x1]="padding.left"
        [attr.x2]="chartW - padding.right"
        [attr.y1]="chartH - padding.bottom"
        [attr.y2]="chartH - padding.bottom"
        stroke="#d1d5db"
        stroke-width="1.5"
        class="axis-line"
      />

      <!-- Y-axis line -->
      <line
        *ngIf="showAxes"
        [attr.x1]="padding.left"
        [attr.x2]="padding.left"
        [attr.y1]="padding.top"
        [attr.y2]="chartH - padding.bottom"
        stroke="#d1d5db"
        stroke-width="1.5"
        class="axis-line"
      />

      <polygon 
        [attr.points]="areaPath()" 
        [attr.fill]="'url(#' + gradientId() + ')'" 
        class="chart-area"
        [class.animated]="chartAnimated"
      />
      <polyline
        [attr.points]="chartPoints()"
        fill="none"
        [attr.stroke]="color"
        stroke-width="3.5"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="chart-line"
        [attr.filter]="'url(#glow-' + gradientId() + ')'"
        [class.animated]="chartAnimated"
      />

      <!-- X-axis labels -->
      <g class="x-axis-labels" *ngIf="showAxes">
        <text
          *ngFor="let label of getXAxisLabels(); let i = index"
          [attr.x]="padding.left + (i / (chartData.length - 1)) * (chartW - padding.left - padding.right)"
          [attr.y]="chartH - padding.bottom + 18"
          fill="#6b7280"
          font-size="11"
          font-weight="500"
          text-anchor="middle"
          class="axis-label"
        >{{ label }}</text>
      </g>
    </svg>
  </div>

  <div class="footer" *ngIf="footer">
    <span class="footer-icon">ðŸ“Š</span>
    <span>{{ footer }}</span>
  </div>
</div>
