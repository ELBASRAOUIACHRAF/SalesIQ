<!--
  SEASONALITY ANALYSIS COMPONENT
  ==============================
  Decomposes sales time series into: Original, Trend, Seasonal, and Residual components
-->

<section class="seasonality-container">
  
  <!-- Header -->
  <header class="seasonality-header">
    <h3><mat-icon class="header-icon">waves</mat-icon> Seasonality Analysis</h3>
    <p class="subtitle">Decompose sales data into trend, seasonal, and residual components</p>
  </header>

  <!-- Form Section -->
  <div class="form-section">
    <div class="input-row">
      <div class="input-group">
        <label for="startDate"><mat-icon class="inline-icon">date_range</mat-icon> Start Date</label>
        <input 
          type="date" 
          id="startDate"
          [(ngModel)]="startDate"
          [max]="endDate"
        />
      </div>
      
      <div class="input-group">
        <label for="endDate"><mat-icon class="inline-icon">event</mat-icon> End Date</label>
        <input 
          type="date" 
          id="endDate"
          [(ngModel)]="endDate"
          [min]="startDate"
        />
      </div>

      <div class="button-group">
        <button 
          class="analyze-button"
          (click)="onAnalyzeClick()"
          [disabled]="isLoading"
        >
        <ng-container *ngIf="!isLoading">
          <mat-icon>analytics</mat-icon> <span>Analyze Seasonality</span>
        </ng-container>
        <ng-container *ngIf="isLoading">
          <mat-icon class="spin">hourglass_empty</mat-icon> <span>Analyzing...</span>
        </ng-container>
        </button>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="error-state">
    <p><mat-icon class="inline-icon">error_outline</mat-icon> {{ errorMessage }}</p>
    <button class="retry-button" (click)="onAnalyzeClick()"><mat-icon>refresh</mat-icon> Retry</button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Analyzing seasonality patterns...</p>
    <code>GET /api/v1/analytics/seasonality</code>
  </div>

  <!-- Initial State -->
  <div *ngIf="!hasAnalyzed && !isLoading" class="initial-state">
    <div class="empty-icon"><mat-icon>ssid_chart</mat-icon></div>
    <p>Select a date range and click <strong>Analyze Seasonality</strong> to decompose your sales data.</p>
  </div>

  <!-- Results Section -->
  <div *ngIf="!isLoading && !errorMessage && hasAnalyzed && hasData" class="results-section">
    
    <!-- Summary -->
    <div class="summary">
      <div class="summary-item">
        <span class="label">Seasonality Type</span>
        <span class="value type-badge">{{ seasonalityType }}</span>
      </div>
      <div class="summary-item">
        <span class="label">Seasonality Strength</span>
        <span class="value">{{ seasonalityStrength | number:'1.2-2' }}</span>
      </div>
    </div>

    <!-- Charts Grid -->
    <div class="charts-grid">
      <div class="chart-card">
        <div class="card-title"><mat-icon class="inline-icon" style="color: #6366f1;">show_chart</mat-icon> Original Series</div>
        <app-chart-kpi-card
          [title]="'Original'"
          [data]="originalValues"
          [xAxisLabels]="originalLabels"
          [showAxes]="true"
          [color]="'#6366f1'"
        ></app-chart-kpi-card>
      </div>

      <div class="chart-card">
        <div class="card-title"><mat-icon class="inline-icon" style="color: #10b981;">trending_up</mat-icon> Trend Component</div>
        <app-chart-kpi-card
          [title]="'Trend'"
          [data]="trendValues"
          [xAxisLabels]="trendLabels"
          [showAxes]="true"
          [color]="'#10b981'"
        ></app-chart-kpi-card>
      </div>

      <div class="chart-card">
        <div class="card-title"><mat-icon class="inline-icon" style="color: #f59e0b;">event_repeat</mat-icon> Seasonal Component</div>
        <app-chart-kpi-card
          [title]="'Seasonality'"
          [data]="seasonalValues"
          [xAxisLabels]="seasonalLabels"
          [showAxes]="true"
          [color]="'#f59e0b'"
        ></app-chart-kpi-card>
      </div>

      <div class="chart-card">
        <div class="card-title"><mat-icon class="inline-icon" style="color: #ef4444;">scatter_plot</mat-icon> Residual (Noise)</div>
        <app-chart-kpi-card
          [title]="'Residual'"
          [data]="residualValues"
          [xAxisLabels]="residualLabels"
          [showAxes]="true"
          [color]="'#ef4444'"
        ></app-chart-kpi-card>
      </div>
    </div>

    <!-- Explanation -->
    <div class="explanation">
      <details>
        <summary><mat-icon class="inline-icon">menu_book</mat-icon> What do these components mean?</summary>
        <div class="explanation-content">
          <ul>
            <li><strong>Original:</strong> Your raw sales data over time</li>
            <li><strong>Trend:</strong> The long-term direction (growth or decline)</li>
            <li><strong>Seasonal:</strong> Repeating patterns (weekly, monthly, yearly cycles)</li>
            <li><strong>Residual:</strong> Random noise after removing trend and seasonality</li>
          </ul>
          <p><em>Formula: Original = Trend + Seasonal + Residual</em></p>
        </div>
      </details>
    </div>
  </div>

  <!-- Empty Results -->
  <div *ngIf="!isLoading && !errorMessage && hasAnalyzed && !hasData" class="empty-results">
    <p><mat-icon class="empty-icon-small">query_stats</mat-icon> No sales data found for the selected period.</p>
    <p>Try selecting a different date range with more data.</p>
  </div>

  <!-- API Info -->
  <div class="api-info">
    <details>
      <summary><mat-icon class="inline-icon">integration_instructions</mat-icon> API Details</summary>
      <div class="api-details">
        <p><strong>Endpoint:</strong> <code>GET /api/v1/analytics/seasonality</code></p>
        <p><strong>Parameters:</strong></p>
        <ul>
          <li><code>startDate</code>: {{ startDate }}</li>
          <li><code>endDate</code>: {{ endDate }}</li>
        </ul>
      </div>
    </details>
  </div>
</section>
