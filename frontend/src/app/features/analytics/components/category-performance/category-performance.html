<div class="category-performance-card">
  <!-- Header -->
  <div class="card-header">
    <div class="header-left">
      <h3 class="card-title">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 3h7v7H3zM14 3h7v7h-7zM14 14h7v7h-7zM3 14h7v7H3z"/>
        </svg>
        Category Performance
      </h3>
      <span class="card-subtitle">Revenue & sales by category</span>
    </div>
    <div class="header-controls">
      <div class="view-toggle">
        <button 
          class="toggle-btn" 
          [class.active]="viewMode === 'chart'"
          (click)="viewMode = 'chart'"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <line x1="3" y1="9" x2="21" y2="9"/>
            <line x1="9" y1="21" x2="9" y2="9"/>
          </svg>
        </button>
        <button 
          class="toggle-btn" 
          [class.active]="viewMode === 'table'"
          (click)="viewMode = 'table'"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="8" y1="6" x2="21" y2="6"/>
            <line x1="8" y1="12" x2="21" y2="12"/>
            <line x1="8" y1="18" x2="21" y2="18"/>
            <line x1="3" y1="6" x2="3.01" y2="6"/>
            <line x1="3" y1="12" x2="3.01" y2="12"/>
            <line x1="3" y1="18" x2="3.01" y2="18"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading category data...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage && !isLoading" class="error-state">
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"/>
      <line x1="12" y1="8" x2="12" y2="12"/>
      <line x1="12" y1="16" x2="12.01" y2="16"/>
    </svg>
    <p>{{ errorMessage }}</p>
    <button class="retry-btn" (click)="loadData()">Retry</button>
  </div>

  <!-- Content -->
  <div *ngIf="!isLoading && !errorMessage" class="card-content">
    <!-- Summary Stats -->
    <div class="summary-stats">
      <div class="stat-item">
        <span class="stat-value">{{ formatCurrency(totalRevenue) }}</span>
        <span class="stat-label">Total Revenue</span>
      </div>
      <div class="stat-item">
        <span class="stat-value">{{ formatNumber(totalQuantity) }}</span>
        <span class="stat-label">Units Sold</span>
      </div>
      <div class="stat-item">
        <span class="stat-value">{{ formatNumber(totalSales) }}</span>
        <span class="stat-label">Total Orders</span>
      </div>
      <div class="stat-item">
        <span class="stat-value">{{ categories.length }}</span>
        <span class="stat-label">Categories</span>
      </div>
    </div>

    <!-- Chart View -->
    <div *ngIf="viewMode === 'chart'" class="chart-view">
      <div class="chart-container">
        <div class="bar-chart">
          <div 
            *ngFor="let category of categories; let i = index" 
            class="bar-row"
          >
            <div class="bar-label">
              <div class="category-indicator" [style.background]="getCategoryColor(i)"></div>
              <span class="category-name">{{ category.categoryName }}</span>
            </div>
            <div class="bar-wrapper">
              <div class="bar-container">
                <div 
                  class="bar revenue-bar" 
                  [style.width.%]="getRevenuePercentage(category.totalRevenue)"
                  [style.background]="getCategoryColor(i)"
                >
                </div>
              </div>
              <div class="bar-values">
                <span class="bar-value primary">{{ formatCurrency(category.totalRevenue) }}</span>
                <span class="bar-value secondary">{{ getRevenueShare(category.totalRevenue) | number:'1.1-1' }}%</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Table View -->
    <div *ngIf="viewMode === 'table'" class="table-view">
      <table class="data-table">
        <thead>
          <tr>
            <th (click)="setSortBy('name')" class="sortable">
              Category
              <span class="sort-icon" *ngIf="sortBy === 'name'">{{ sortDirection === 'asc' ? '↑' : '↓' }}</span>
            </th>
            <th (click)="setSortBy('revenue')" class="sortable text-right">
              Revenue
              <span class="sort-icon" *ngIf="sortBy === 'revenue'">{{ sortDirection === 'asc' ? '↑' : '↓' }}</span>
            </th>
            <th (click)="setSortBy('quantity')" class="sortable text-right">
              Qty Sold
              <span class="sort-icon" *ngIf="sortBy === 'quantity'">{{ sortDirection === 'asc' ? '↑' : '↓' }}</span>
            </th>
            <th (click)="setSortBy('sales')" class="sortable text-right">
              Orders
              <span class="sort-icon" *ngIf="sortBy === 'sales'">{{ sortDirection === 'asc' ? '↑' : '↓' }}</span>
            </th>
            <th class="text-right">Share</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let category of categories; let i = index">
            <td>
              <div class="category-cell">
                <div class="category-indicator" [style.background]="getCategoryColor(i)"></div>
                {{ category.categoryName }}
              </div>
            </td>
            <td class="text-right font-medium">{{ formatCurrency(category.totalRevenue) }}</td>
            <td class="text-right">{{ formatNumber(category.totalQuantitySold) }}</td>
            <td class="text-right">{{ formatNumber(category.totalSales) }}</td>
            <td class="text-right">
              <div class="share-cell">
                <div class="share-bar-container">
                  <div 
                    class="share-bar" 
                    [style.width.%]="getRevenueShare(category.totalRevenue)"
                    [style.background]="getCategoryColor(i)"
                  ></div>
                </div>
                <span class="share-value">{{ getRevenueShare(category.totalRevenue) | number:'1.1-1' }}%</span>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Empty State -->
    <div *ngIf="categories.length === 0" class="empty-state">
      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M3 3h7v7H3zM14 3h7v7h-7zM14 14h7v7h-7zM3 14h7v7H3z"/>
      </svg>
      <p>No category data available</p>
    </div>
  </div>
</div>
