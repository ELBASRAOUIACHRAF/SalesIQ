<div class="dashboard-layout">
  <div class="dashboard-content">
    <div class="dashboard-header">
      <app-top-bar
        [title]="'Products Dashboard'"
        [tabs]="[]"
        [activeTab]="''"
        [dateText]="'Product Analytics'"
        [buttonLabel]="''"
      ></app-top-bar>
      
      <!-- Import/Export Actions -->
      <div class="action-bar">
        <div class="action-group">
          <span class="group-label">Products:</span>
          <button class="action-btn import-btn" (click)="triggerImport('products')">
            <mat-icon class="icon">file_upload</mat-icon> Import
          </button>
          <button class="action-btn export-btn" (click)="onExport('products')">
            <mat-icon class="icon">file_download</mat-icon> Export
          </button>
        </div>
        <div class="action-group">
          <span class="group-label">Search History:</span>
          <button class="action-btn import-btn" (click)="triggerImport('search-history')">
            <mat-icon class="icon">file_upload</mat-icon> Import
          </button>
          <button class="action-btn export-btn" (click)="onExport('search-history')">
            <mat-icon class="icon">file_download</mat-icon> Export
          </button>
        </div>
        <input 
          #fileInput 
          type="file" 
          accept=".csv" 
          style="display: none;" 
          (change)="onFileSelected($event)"
        />
      </div>
      
      <!-- Import Status Message -->
      <div *ngIf="importMessage" class="import-message" [class.success]="importSuccess" [class.error]="!importSuccess">
        <mat-icon class="msg-icon">{{ importSuccess ? 'check_circle' : 'error' }}</mat-icon>
        {{ importMessage }}
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>Loading product data...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-state">
      <mat-icon class="error-icon">error_outline</mat-icon>
      <p class="error-message">{{ error }}</p>
      <button class="retry-btn" (click)="fetchProducts()">
        <mat-icon>refresh</mat-icon> Retry
      </button>
    </div>

    <!-- Dashboard Content -->
    <ng-container *ngIf="!loading && !error">
      <!-- Small KPI Cards -->
      <div class="kpi-cards">
        <app-kpi-card
          *ngFor="let k of kpis"
          [title]="k.title"
          [value]="k.value"
          [subtitle]="k.subtitle"
          [change]="k.change"
          [sparkline]="k.sparkline"
          [accentColor]="k.accentColor"
        ></app-kpi-card>
      </div>

      <!-- Product Analytics Section -->
      <section class="analytics-section">
        <h2 class="section-title">
          <mat-icon class="section-icon">query_stats</mat-icon>
          Product Analytics
        </h2>
        <div class="analytics-grid">
          <app-abc-analysis></app-abc-analysis>
          <app-potential-bestsellers></app-potential-bestsellers>
        </div>
      </section>

      <!-- Inventory Section -->
      <section class="analytics-section">
        <h2 class="section-title">
          <mat-icon class="section-icon">inventory</mat-icon>
          Inventory Management
        </h2>
        <div class="inventory-grid">
          <app-stockout-prediction></app-stockout-prediction>
        </div>
      </section>
    </ng-container>
  </div>
</div>
