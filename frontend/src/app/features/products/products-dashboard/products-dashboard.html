<div class="dashboard-layout">
  <div class="dashboard-content">
    <div class="dashboard-header">
      <app-top-bar
        [title]="'Products Dashboard'"
        [tabs]="[]"
        [activeTab]="''"
        [dateText]="'Product Analytics'"
        [buttonLabel]="''"
      ></app-top-bar>
      
      <!-- Import/Export Actions -->
      <div class="action-bar">
        <div class="action-group">
          <span class="group-label">Products:</span>
          <button class="action-btn import-btn" (click)="triggerImport('products')">
            <span class="icon">ðŸ“¥</span> Import
          </button>
          <button class="action-btn export-btn" (click)="onExport('products')">
            <span class="icon">ðŸ“¤</span> Export
          </button>
        </div>
        <div class="action-group">
          <span class="group-label">Search History:</span>
          <button class="action-btn import-btn" (click)="triggerImport('search-history')">
            <span class="icon">ðŸ“¥</span> Import
          </button>
          <button class="action-btn export-btn" (click)="onExport('search-history')">
            <span class="icon">ðŸ“¤</span> Export
          </button>
        </div>
        <input 
          #fileInput 
          type="file" 
          accept=".csv" 
          style="display: none;" 
          (change)="onFileSelected($event)"
        />
      </div>
      
      <!-- Import Status Message -->
      <div *ngIf="importMessage" class="import-message" [class.success]="importSuccess" [class.error]="!importSuccess">
        {{ importMessage }}
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>Loading product data...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-state">
      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"/>
        <line x1="12" y1="8" x2="12" y2="12"/>
        <line x1="12" y1="16" x2="12.01" y2="16"/>
      </svg>
      <p class="error-message">{{ error }}</p>
      <button class="retry-btn" (click)="fetchProducts()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M23 4v6h-6M1 20v-6h6"/>
          <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
        </svg>
        Retry
      </button>
    </div>

    <!-- Dashboard Content -->
    <ng-container *ngIf="!loading && !error">
      <!-- Small KPI Cards -->
      <div class="kpi-cards">
        <app-kpi-card
          *ngFor="let k of kpis"
          [title]="k.title"
          [value]="k.value"
          [subtitle]="k.subtitle"
          [change]="k.change"
          [sparkline]="k.sparkline"
          [accentColor]="k.accentColor"
        ></app-kpi-card>
      </div>

      <!-- Product Analytics Section -->
      <section class="analytics-section">
        <h2 class="section-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
            <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
            <line x1="12" y1="22.08" x2="12" y2="12"/>
          </svg>
          Product Analytics
        </h2>
        <div class="analytics-grid">
          <app-abc-analysis></app-abc-analysis>
          <app-potential-bestsellers></app-potential-bestsellers>
        </div>
      </section>

      <!-- Inventory Section -->
      <section class="analytics-section">
        <h2 class="section-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
            <line x1="12" y1="9" x2="12" y2="13"/>
            <line x1="12" y1="17" x2="12.01" y2="17"/>
          </svg>
          Inventory Management
        </h2>
        <div class="inventory-grid">
          <app-stockout-prediction></app-stockout-prediction>
        </div>
      </section>
    </ng-container>
  </div>
</div>
