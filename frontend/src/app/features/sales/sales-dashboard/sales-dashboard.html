<div class="dashboard-layout">
  <div class="dashboard-content">
    <div class="dashboard-header">
      <app-top-bar
        [title]="'Sales Analytics'"
        [tabs]="['Overview','Forecast','Analysis']"
        [activeTab]="activeTab"
        [dateText]="'Sales Performance Insights'"
        [buttonLabel]="''"
        (tabChange)="onTabChange($event)"
      ></app-top-bar>
      
      <!-- Import/Export Actions -->
      <div class="action-bar">
        <div class="action-group">
          <span class="group-label">Sales:</span>
          <button class="action-btn import-btn" (click)="triggerImport('sales')">
            <mat-icon class="icon">file_upload</mat-icon> Import
          </button>
          <button class="action-btn export-btn" (click)="onExport('sales')">
            <mat-icon class="icon">file_download</mat-icon> Export
          </button>
        </div>
        <div class="action-group">
          <span class="group-label">Sold Products:</span>
          <button class="action-btn import-btn" (click)="triggerImport('sold-products')">
            <mat-icon class="icon">file_upload</mat-icon> Import
          </button>
          <button class="action-btn export-btn" (click)="onExport('sold-products')">
            <mat-icon class="icon">file_download</mat-icon> Export
          </button>
        </div>
        <div class="action-group">
          <span class="group-label">Baskets:</span>
          <button class="action-btn import-btn" (click)="triggerImport('baskets')">
            <mat-icon class="icon">file_upload</mat-icon> Import
          </button>
          <button class="action-btn export-btn" (click)="onExport('baskets')">
            <mat-icon class="icon">file_download</mat-icon> Export
          </button>
        </div>
        <input 
          #fileInput 
          type="file" 
          accept=".csv" 
          style="display: none;" 
          (change)="onFileSelected($event)"
        />
      </div>
      
      <!-- Import Status Message -->
      <div *ngIf="importMessage" class="import-message" [class.success]="importSuccess" [class.error]="!importSuccess">
        <mat-icon class="msg-icon">{{ importSuccess ? 'check_circle' : 'error' }}</mat-icon>
        {{ importMessage }}
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <div class="loading-spinner"></div>
      <p>Loading sales data...</p>
    </div>

    <!-- KPI Cards -->
    <div *ngIf="!isLoading" class="kpi-cards">
      <app-kpi-card
        *ngFor="let k of kpis"
        [title]="k.title"
        [value]="k.isCurrency ? formatCurrency(k.value) : formatNumber(k.value)"
        [subtitle]="k.subtitle"
        [change]="k.change"
        [sparkline]="k.sparkline"
        [accentColor]="k.accentColor"
      ></app-kpi-card>
    </div>

    <!-- OVERVIEW TAB -->
    <ng-container *ngIf="activeTab === 'Overview'">
      <!-- Sales Trend -->
      <section class="analytics-section">
        <h2 class="section-title">üìà Sales Trend Analysis</h2>
        <p class="section-description">Analyze sales patterns over time with different granularities</p>
        <div class="component-wrapper">
          <app-sales-trend-chart></app-sales-trend-chart>
        </div>
      </section>

      <!-- Seasonality Analysis -->
      <section class="analytics-section">
        <h2 class="section-title">üå°Ô∏è Seasonality Analysis</h2>
        <p class="section-description">Decompose sales data into trend, seasonal, and residual components</p>
        <div class="component-wrapper">
          <app-seasonality-chart></app-seasonality-chart>
        </div>
      </section>
    </ng-container>

    <!-- FORECAST TAB -->
    <ng-container *ngIf="activeTab === 'Forecast'">
      <!-- Forecasting & Comparison -->
      <section class="analytics-section">
        <h2 class="section-title">üîÆ Forecasting & Period Comparison</h2>
        <p class="section-description">Predict future sales and compare performance across periods</p>
        <div class="analytics-grid two-col">
          <app-sales-forecast></app-sales-forecast>
          <app-period-comparison></app-period-comparison>
        </div>
      </section>

      <!-- Growth Rate Analysis -->
      <section class="analytics-section">
        <h2 class="section-title">üìä Growth Rate Analysis</h2>
        <p class="section-description">Calculate and visualize sales growth between periods</p>
        <div class="component-wrapper">
          <app-growth-rate-card></app-growth-rate-card>
        </div>
      </section>
    </ng-container>

    <!-- ANALYSIS TAB -->
    <ng-container *ngIf="activeTab === 'Analysis'">
      <!-- Cohort & Purchase Frequency -->
      <section class="analytics-section">
        <h2 class="section-title">üë• Customer Purchase Behavior</h2>
        <p class="section-description">Analyze cohort behavior and purchase frequency patterns</p>
        <div class="analytics-grid two-col">
          <app-cohort-card></app-cohort-card>
          <app-purchase-frequency></app-purchase-frequency>
        </div>
      </section>

      <!-- Anomaly Detection -->
      <section class="analytics-section">
        <h2 class="section-title">‚ö†Ô∏è Anomaly Detection</h2>
        <p class="section-description">Identify unusual spikes or drops in sales patterns</p>
        <div class="component-wrapper">
          <app-anomaly-detection></app-anomaly-detection>
        </div>
      </section>
    </ng-container>

  </div>
</div>

