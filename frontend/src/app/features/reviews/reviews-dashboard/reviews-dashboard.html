<div class="dashboard-layout">
  <div class="dashboard-content">
    <div class="dashboard-header">
      <app-top-bar
        [title]="'Reviews Analytics'"
        [tabs]="[]"
        [activeTab]="''"
        [dateText]="'Sentiment Analysis'"
        [buttonLabel]="''"
      ></app-top-bar>
      
      <!-- Import/Export Actions -->
      <div class="action-bar">
        <div class="action-group">
          <span class="group-label">Reviews:</span>
          <button class="action-btn import-btn" (click)="triggerImport()">
            <mat-icon class="icon">file_upload</mat-icon> Import
          </button>
          <button class="action-btn export-btn" (click)="onExportReviews()">
            <mat-icon class="icon">file_download</mat-icon> Export
          </button>
        </div>
        <input 
          #fileInput 
          type="file" 
          accept=".csv" 
          style="display: none;" 
          (change)="onFileSelected($event)"
        />
      </div>
      
      <!-- Import Status Message -->
      <div *ngIf="importMessage" class="import-message" [class.success]="importSuccess" [class.error]="!importSuccess">
        <mat-icon class="msg-icon">{{ importSuccess ? 'check_circle' : 'error' }}</mat-icon>
        {{ importMessage }}
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <div class="loading-spinner"></div>
      <p>Loading reviews data...</p>
    </div>

    <ng-container *ngIf="!isLoading">
      <div class="kpi-cards">
        <app-kpi-card
          *ngFor="let k of kpis"
          [title]="k.title"
          [value]="k.value"
          [subtitle]="k.subtitle"
          [change]="k.change"
          [sparkline]="k.sparkline"
          [accentColor]="k.accentColor"
        ></app-kpi-card>
      </div>

      <div class="pies-row">
        <app-kpi-pie-chart
          title="Sentiment Distribution"
          [value]="pieTotal"
          subtitle="Total reviews analyzed"
          [segments]="pieData"
        ></app-kpi-pie-chart>
      </div>

      <!-- Reviews Analytics Component -->
      <div class="analytics-section">
        <app-reviews-analytics></app-reviews-analytics>
      </div>
    </ng-container>
  </div>
</div>

