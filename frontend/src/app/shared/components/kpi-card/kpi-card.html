<div
  class="kpi-card"
  [style.--accent]="accentColor"
  role="group"
  [attr.aria-label]="title"
>
  <div class="kpi-top">
    <div class="kpi-left">
      <div class="icon" *ngIf="iconUrl || iconClass">
        <img
          *ngIf="iconUrl"
          [src]="iconUrl"
          [alt]="title + ' icon'"
        />
        <i
          *ngIf="!iconUrl && iconClass"
          [class]="iconClass"
          aria-hidden="true"
        ></i>
      </div>

      <div class="meta">
        <div class="title">{{ title }}</div>
        <div class="subtitle" *ngIf="subtitle">
          {{ subtitle }}
        </div>
      </div>
    </div>

    <div
      class="kpi-change"
      *ngIf="change !== undefined"
      [class.up]="change > 0"
      [class.down]="change < 0"
      [class.neutral]="change === 0"
    >
      <span class="arrow">
        {{ change > 0 ? '▲' : change < 0 ? '▼' : '•' }}
      </span>
      <span>{{ change | number:'1.0-2' }}%</span>
    </div>
  </div>

  <div class="kpi-value" #valueElement>
    {{ formatValue() }}
  </div>

  <div class="kpi-spark" *ngIf="sparkline.length > 0">
    <svg
      viewBox="0 0 120 32"
      preserveAspectRatio="none"
      aria-hidden="true"
      class="sparkline-svg"
    >
      <defs>
        <linearGradient id="sparkline-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" [attr.stop-color]="accentColor" stop-opacity="0.6" />
          <stop offset="100%" [attr.stop-color]="accentColor" stop-opacity="1" />
        </linearGradient>
      </defs>
      <polyline
        [attr.points]="sparkPoints()"
        fill="none"
        stroke="url(#sparkline-gradient)"
        stroke-width="2.5"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="sparkline-path"
      />
    </svg>
  </div>
</div>
